<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Memo App</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
</head>
<body>
    <h1>Memo App</h1>
    <form action="/add" method="POST">
        <input type="text" name="content" placeholder="メモを追加" required>
        <button type="submit">追加</button>
    </form>
    <ul id="memo-list">
        {% for memo in memos %}
            <li>
                {{ memo[1] }} 
                <button onclick="deleteMemo({{ memo[0] }})">削除</button>
                <img src="{{ url_for('qr_code', data=memo[1]) }}" alt="QR Code" style="width: 50px; height: 50px;">
            </li>
        {% endfor %}
    </ul>
    
    <script>
        const socket = io();

        socket.on('new_memo', function(data) {
            const listItem = document.createElement('li');
            listItem.textContent = data.content;

            // QRコードを生成するためのimgタグ
            const qrCode = document.createElement('img');
            qrCode.src = `/qr_code/${data.content}`;
            qrCode.alt = "QR Code";
            qrCode.style.width = "50px";
            qrCode.style.height = "50px";
            listItem.appendChild(qrCode);

            // 削除ボタンを追加
            const deleteButton = document.createElement('button');
            deleteButton.textContent = "削除";
            deleteButton.onclick = function() {
                deleteMemo(data.id); // メモIDを削除関数に渡す
            };
            listItem.appendChild(deleteButton);

            document.getElementById('memo-list').appendChild(listItem);
        });

        function deleteMemo(memoId) {
            fetch(`/delete/${memoId}`, {
                method: 'POST'
            })
            .then(response => {
                if (response.ok) {
                    location.reload(); // 成功したらページをリロード
                }
            });
        }
    </script>
</body>
</html>
